@using System.Text.Json
@using System.Text.Json.Serialization
@model List<Employee>

@functions {
    public class EmployeeDto {
        public int Id { get; set; }
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public string Status { get; set; }
        public List<string> Groups { get; set; }
        public List<TrainingOrderDto> TrainingOrdersAsTrainer { get; set; }
    }

    public class TrainingOrderDto {
        public int Duration { get; set; }
    }

    public string SerializeEmployee(Employee employee) {
        var dto = new EmployeeDto {
            Id = employee.Id,
            FirstName = employee.FirstName,
            LastName = employee.LastName,
            Status = employee.Status,
            Groups = employee.Groups.Select(g => g.Name).ToList(),
            TrainingOrdersAsTrainer = employee.TrainingOrdersAsTrainer
                .Select(t => new TrainingOrderDto { Duration = t.Duration })
                .ToList()
        };

        var options = new JsonSerializerOptions {
            PropertyNamingPolicy = JsonNamingPolicy.CamelCase,
            WriteIndented = false
        };

        return JsonSerializer.Serialize(dto, options);
    }
}

<div class="people-container">
   <div class="search">
      <input type="search" placeholder="Search By Name" />
   </div>

   <ul class="item-container">
      @foreach (var item in Model) {
         var employeeJson = SerializeEmployee(item);
         <li onclick="setSelected('@Html.Raw(employeeJson)')" class="item">
            <div class="photo">
               <div class="frame"></div>
            </div>
            <div class="info">
               <p>@item.FirstName @item.LastName</p>
               <div class="sub">
                  <p>Status: </p>
                  <p class="@(item.Status == "Trainer" ? "highlight" : "")">@item.Status</p>
               </div>
            </div>
            <div class="selector">
               <img src="~/images/add.svg" onclick="addItemToPartial('@item.Id', '@item.FirstName', '@item.LastName')" />
            </div>
         </li>
      }
   </ul>

   <p>Selected:</p>
   <div class="list-container">
      <div class="selected-list">
         <ul id="partialTempList"></ul>
      </div>
   </div>
   <button class="btn btnWhite nbg-btn" onclick="confirmSelectionInPartial()">Add Trainer</button>
</div>

<div class="details">
   <div class="top">
      <div id="info-container" class="info-container">
         <p id="name" class="title"></p>
         <div class="info">
            <p class="one">Status</p>
            <p id="status" class="two"></p>
         </div>
         <div class="info">
            <p class="one">Trainer Groups:</p>
         </div>
         <div id="group-list" class="list">
            <div class="item">Placeholder</div>
         </div>
         <div class="info">
            <p class="one">Assigned Trainings:</p>
         </div>
         <div id="training-list" class="list">
            <div class="item">Placeholder</div>
         </div>
         <div class="info">
            <p class="one">Total Assigned Hours:</p>
            <p id="total-hours" class="two"></p>
         </div>
      </div>
   </div>
</div>

<script src="~/js/people.js"></script>

<script>
   var selected;

   function setSelected(employeeJson) {
      var infoContainer = document.getElementById('info-container');
      if (infoContainer.style.display != "flex") {
         infoContainer.style.display = "flex";
      }
      selected = JSON.parse(employeeJson);
      updateSelected();
   }

   function updateSelected() {
      document.getElementById('name').textContent = selected.firstName + " " + selected.lastName;
      document.getElementById('status').textContent = selected.status;

      var groupList = document.getElementById('group-list');
      groupList.innerHTML = '';
      selected.groups.forEach(function (group) {
         var item = document.createElement('p');
         item.classList.add('item');
         item.textContent = group;
         groupList.appendChild(item);
      });

      var time = 0;
      var trainingList = document.getElementById('training-list');
      trainingList.innerHTML = '';
      selected.trainingOrdersAsTrainer.forEach(function (order) {
         var item = document.createElement('p');
         item.classList.add('item');
         item.textContent = order.trainingName;
         trainingList.appendChild(item);
         time += order.duration;
      });

      document.getElementById('total-hours').textContent = time;
   }
</script>