@page
@model WCSTrainer.Pages.Lessons.DetailsModel

@using Microsoft.AspNetCore.Identity
@inject SignInManager<UserAccount> SignInManager
@inject UserManager<UserAccount> UserManager

<div class="panel">
   <div class="body">
      <partial name="_Sidebar" />
      <div class="properties">
         <div class="user-form">
            <p class="title">Lesson #@Model.Lesson.Id</p>
            <div class="field-container">
               <div class="lesson-details">
                  <h1>@Model.Lesson.Name</h1>
                  @if (Model.Lesson.Descriptions.Any()) {
                     <div class="lesson-images">
                        <div id="lessonImageCarousel" class="carousel slide" data-ride="carousel">
                           <div class="carousel-inner">
                              @foreach (var description in Model.Lesson.Descriptions) {
                                 if (description != null) {
                                    <div class="carousel-item">
                                       <img src="~/@description.ImageUpload.FilePath"
                                            class="d-block w-100"
                                            alt="Lesson Image" />
                                       @if (!string.IsNullOrWhiteSpace(description.TextContent))
                                       {
                                          <div class="carousel-caption d-none d-md-block">
                                             <p>@description.TextContent</p>
                                          </div>
                                       }
                                    </div>
                                 }
                              }
                           </div>
                           @if (Model.Lesson.Descriptions.Count > 1) {
                              <a class="carousel-control-prev" href="#lessonImageCarousel" role="button" data-slide="prev">
                                 <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                 <span class="sr-only">Previous</span>
                              </a>
                              <a class="carousel-control-next" href="#lessonImageCarousel" role="button" data-slide="next">
                                 <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                 <span class="sr-only">Next</span>
                              </a>
                           }
                        </div>
                     </div>
                  }
               </div>
            </div>
            <div class="btn-container">
               <a class="btn bg-btn btnGreen" asp-page="./Edit" asp-route-id="@Model.Lesson.Id">Edit</a>
               @if (SignInManager.IsSignedIn(User)) {
                  var user = await UserManager.GetUserAsync(User);
                  if (user != null) {
                     var isOwner = await UserManager.IsInRoleAsync(user, "owner");
                     if (isOwner) {
                        <a class="btn bg-btn btnRed" asp-page="./Delete" asp-route-id="@Model.Lesson.Id">Delete</a>
                     }
                  }
               }
            </div>
         </div>
      </div>
   </div>
</div>
