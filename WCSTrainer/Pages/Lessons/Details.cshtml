@page
@model WCSTrainer.Pages.Lessons.DetailsModel
@using System.Text.RegularExpressions

@functions {
   public string ConvertContent(string content) {
      var urlRegex = new Regex(@"(http|https)://[^\s]+");
      return urlRegex.Replace(content, match => {
         var url = match.Value;

         if (url.Contains("youtube.com/watch?v=") || url.Contains("youtu.be/")) {
            // Extract YouTube video ID
            var videoId = ExtractYouTubeId(url);
            if (videoId != null) {
               // Return YouTube embed iframe
               return $"<iframe class=\"description-video\" width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/{videoId}\" frameborder=\"0\" allowfullscreen></iframe>";
            }
         }

         // Return as a normal clickable link for non-YouTube URLs
         return $"<a class=\"description-link\" href=\"{url}\" target=\"_blank\">{url}</a>";
      });
   }

   private string ExtractYouTubeId(string url) {
      // Extract the video ID from the YouTube link (watch?v= or youtu.be/)
      var youtubeIdRegex = new Regex(@"(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})");
      var match = youtubeIdRegex.Match(url);
      return match.Success ? match.Groups[1].Value : null;
   }
}



<div class="panel">
   <div class="body">
      <partial name="_Sidebar" />
      <div class="properties">
         <div class="user-form">
            <p class="title">Lesson #@Model.Lesson.Id</p>
            <div class="field-container">
               <div class="text-group">
                  <p class="title">Name</p>
                  <p class="info">@Model.Lesson.Name</p>
               </div>
               <div class="text-group">
                  <p class="title">Description</p>
                  <div class="info">
                     <pre class="description-container">@Html.Raw(ConvertContent(Model.Lesson.Description))</pre>
                  </div>
               </div>
            </div>
            <div class="btn-container">
               <a class="btn bg-btn btnGreen" asp-page="./Edit" asp-route-id="@Model.Lesson.Id">
                  Edit
               </a>
            </div>
         </div>
      </div>
   </div>
</div>